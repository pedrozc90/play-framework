# PostgreSQL Configuration File

# -----------------------------
# EXTENSIONS & QUERY TRACKING
# -----------------------------
shared_preload_libraries = 'pg_stat_statements'
compute_query_id = on
pg_stat_statements.track = all
pg_stat_statements.max = 10000
track_activity_query_size = 2048

# -----------------------------
# LOGGING - WHAT TO LOG
# -----------------------------
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on

# Log temp files larger than 10MB
log_temp_files = 10240

# Log queries slower than 500ms (adjust based on your needs)
# - Use 1000+ for production (slow queries only)
# - Use 100-500 for performance monitoring
# - Use 0 for debugging (logs everything - not recommended)
log_min_duration_statement = 500

# Log autovacuum operations slower than 1 second
log_autovacuum_min_duration = 1000

# -----------------------------
# LOGGING - LOG FORMAT
# -----------------------------
# Log line format: timestamp [pid]: [line_number] user=username,db=database,app=application,client=client_address
log_line_prefix = '%t [%p]: [%l] %quser=%u,db=%d,app=%a,client=%h '

# Log destination (stderr is default for Docker)
log_destination = 'stderr'
logging_collector = off

# -----------------------------
# CONNECTION SETTINGS
# -----------------------------
listen_addresses = '*'
max_connections = 100

# -----------------------------
# MEMORY SETTINGS
# -----------------------------
# Adjust based on available RAM (typically 25% of system RAM)
shared_buffers = 1GB
effective_cache_size = 3GB
work_mem = 16MB
maintenance_work_mem = 256MB

# -----------------------------
# WRITE AHEAD LOG (WAL)
# -----------------------------
wal_level = replica
max_wal_size = 2GB
min_wal_size = 1GB
checkpoint_completion_target = 0.9

# -----------------------------
# QUERY PLANNER
# -----------------------------
random_page_cost = 1.1  # Lower for SSD (default is 4.0 for HDD)
effective_io_concurrency = 200  # Higher for SSD

# -----------------------------
# PERFORMANCE
# -----------------------------
default_statistics_target = 100
